<!-- Main Container with premium styling -->
<div class="container-fluid px-0">
  <!-- New Check Creation (shown when no active check) -->
  <div *ngIf="!currentCheck" class="eligibility-dashboard">
    <!-- Hero section for new check -->
    <div class="card new-check-card mb-5 border-0"
      style="background: linear-gradient(to right, #f8f9fa, #ffffff); box-shadow: 0 4px 24px rgba(0, 0, 0, 0.08);">
      <div class="card-header py-3"
        style="background: linear-gradient(135deg, #4e54c8, #8f94fb); border-radius: 0.375rem 0.375rem 0 0 !important;">
        <div class="d-flex justify-content-between align-items-center">
          <h4 class="mb-0 text-white"><i class="fas fa-user-graduate me-2"></i> Start New Eligibility Check</h4>
          <span class="badge bg-white text-primary rounded-pill px-3 py-2">Step 1 of 3</span>
        </div>
      </div>
      <div class="card-body px-4 py-4">
        <form [formGroup]="newCheckForm" class="needs-validation" novalidate>
          <div class="row g-3">
            <div class="col-md-6">
              <div class="form-floating">
                <input type="text" class="form-control" id="candidateName" formControlName="candidateName"
                  placeholder="Enter candidate's full name" required>
                <label for="candidateName">Candidate Name</label>
                <div class="invalid-feedback">
                  Please provide the candidate's name.
                </div>
              </div>
            </div>
            <div class="col-md-6">
              <div class="form-floating">
                <select class="form-select" id="examType" formControlName="examType" required
                  style="padding-top: 1.625rem; padding-bottom: 0.625rem;">
                  <option value="" disabled selected>-- Select Exam Type --</option>
                  <option *ngFor="let type of examTypes" [value]="type">{{type}}</option>
                </select>
                <label for="examType">Exam Type</label>
                <div class="invalid-feedback">
                  Please select an exam type.
                </div>
              </div>
            </div>
          </div>

          <div class="text-center mt-4">
            <button class="btn btn-primary btn-lg px-5 rounded-pill shadow-sm" (click)="initiateCheck()"
              style="background: linear-gradient(135deg, #4e54c8, #8f94fb); border: none;">
              <i class="fas fa-play-circle me-2"></i> Start New Check
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Previous Checks List -->
    <div *ngIf="userChecks.length > 0" class="card border-0 shadow-sm">
      <div class="card-header bg-white border-bottom-0 py-3">
        <div class="d-flex justify-content-between align-items-center">
          <h4 class="mb-0"><i class="fas fa-history me-2 text-muted"></i> Your Previous Checks</h4>
          <span class="badge bg-light text-dark rounded-pill">{{userChecks.length}} checks</span>
        </div>
      </div>
      <div class="card-body px-0 pb-0">
        <div class="table-responsive">
          <table class="table table-hover align-middle mb-0">
            <thead class="table-light">
              <tr>
                <th class="ps-4">Candidate</th>
                <th>Date</th>
                <th>Payment</th>
                <th>Status</th>
                <th class="pe-4 text-end">Action</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let check of userChecks" class="check-row" style="cursor: pointer;">
                <td class="ps-4 fw-bold">{{check.candidateName}}</td>
                <td>{{check.createdAt | date:'mediumDate'}}</td>
                <td>
                  <span class="badge rounded-pill py-1 px-3" [ngClass]="{
                    'bg-success-light text-success': check.paymentStatus === 'paid',
                    'bg-warning-light text-warning': check.paymentStatus === 'pending',
                    'bg-danger-light text-danger': check.paymentStatus === 'failed'
                  }">
                    <i class="fas fa-circle me-1" style="font-size: 6px; vertical-align: middle;"></i>
                    {{check.paymentStatus | titlecase}}
                  </span>
                </td>
                <td>
                  <span class="badge rounded-pill py-1 px-3" [ngClass]="{
                    'bg-success-light text-success': check.checkStatus === 'completed',
                    'bg-primary-light text-primary': check.checkStatus === 'in_progress',
                    'bg-secondary-light text-secondary': check.checkStatus === 'not_started'
                  }">
                    <i class="fas fa-circle me-1" style="font-size: 6px; vertical-align: middle;"></i>
                    {{check.checkStatus | titlecase}}
                  </span>
                </td>
                <td class="pe-4 text-end">
                  <button class="btn btn-sm rounded-pill shadow-sm" [ngClass]="{
                      'btn-outline-primary': check.paymentStatus === 'paid',
                      'btn-primary': check.paymentStatus !== 'paid'
                    }" (click)="resumeCheck(check.id)" style="min-width: 120px;">
                    {{check.paymentStatus === 'paid' ? 'Continue' : 'Pay & Continue'}}
                    <i class="fas fa-arrow-right ms-2"></i>
                  </button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <!-- Active Check Workflow -->
  <div *ngIf="currentCheck" class="active-check-container">
    <!-- Payment Step (shown if not paid) -->
    <div *ngIf="currentCheck.paymentStatus !== 'paid'" class="card border-0 mb-4"
      style="box-shadow: 0 4px 24px rgba(0, 0, 0, 0.08);">
      <div class="card-header py-3"
        style="background: linear-gradient(135deg, #4e54c8, #8f94fb); border-radius: 0.375rem 0.375rem 0 0 !important;">
        <div class="d-flex justify-content-between align-items-center">
          <h4 class="mb-0 text-white"><i class="fas fa-credit-card me-2"></i> Payment Required</h4>
          <span class="badge bg-white text-primary rounded-pill px-3 py-2">Step 2 of 3</span>
        </div>
      </div>
      <div class="card-body px-4 py-4">
        <div class="row">
          <div class="col-lg-8">
            <div class="alert alert-info border-0 mb-4" style="background-color: rgba(13, 110, 253, 0.1);">
              <div class="d-flex">
                <div class="flex-shrink-0">
                  <i class="fas fa-info-circle text-info mt-1 fs-4"></i>
                </div>
                <div class="flex-grow-1 ms-3">
                  <h5 class="alert-heading">What happens after payment?</h5>
                  <p class="mb-2">Once your payment is confirmed, you'll be able to:</p>
                  <ul class="mb-2 ps-3">
                    <li class="mb-2"><i class="fas fa-check-circle text-success me-2"></i> <strong>Pull WAEC results
                        automatically</strong> - Retrieve official results directly</li>
                    <li><i class="fas fa-check-circle text-success me-2"></i> <strong>OR enter results manually</strong>
                      - Input grades yourself if preferred</li>
                  </ul>
                  <hr class="my-2">
                  <p class="mb-0 small"><i class="fas fa-exclamation-circle me-2"></i><strong>Note:</strong> Both
                    options give access to comprehensive result analysis.</p>
                </div>
              </div>
            </div>
          </div>

          <div class="col-lg-4">
            <div class="payment-summary-card p-4 rounded-3 border-0"
              style="background: linear-gradient(to bottom, #ffffff, #f8f9fa); box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);">
              <h5 class="fw-bold mb-4 text-center">Payment Summary</h5>
              <div class="d-flex justify-content-between mb-2">
                <span class="text-muted">Service Fee:</span>
                <strong>GHS 5,000</strong>
              </div>
              <div class="d-flex justify-content-between mb-3">
                <span class="text-muted">Convenience Fee:</span>
                <strong>GHS 200</strong>
              </div>
              <hr class="my-3">
              <div class="d-flex justify-content-between total-amount fw-bold fs-5">
                <span>Total Amount:</span>
                <strong class="text-primary">GHS 5,200</strong>
              </div>

              <button class="btn btn-primary w-100 mt-4 py-3 rounded-pill shadow-sm" (click)="simulatePayment()"
                style="background: linear-gradient(135deg, #4e54c8, #8f94fb); border: none;">
                <i class="fas fa-lock me-2"></i> Proceed to Secure Payment
              </button>

              <div class="text-center mt-3 small text-muted">
                <i class="fas fa-shield-alt me-2"></i> All payments are secure and encrypted
              </div>
            </div>
          </div>
        </div>

        <div class="text-center mt-4">
          <button class="btn btn-outline-secondary rounded-pill px-4 shadow-sm" (click)="cancelCurrentCheck()">
            <i class="fas fa-arrow-left me-2"></i> Back to All Checks
          </button>
        </div>
      </div>
    </div>

    <!-- Results Forms (shown after payment) -->
    <div *ngIf="currentCheck.paymentStatus === 'paid'">
      <div class="alert alert-primary border-0 mb-4 d-flex justify-content-between align-items-center py-3"
        style="background-color: rgba(13, 110, 253, 0.1);">
        <div class="d-flex align-items-center">
          <i class="fas fa-user-graduate me-3 fs-4 text-primary"></i>
          <div>
            <h6 class="mb-0">Currently processing check for:</h6>
            <strong class="fs-5">{{currentCheck.candidateName}}</strong> ({{currentCheck.examDetails.examType}})
          </div>
        </div>
        <button class="btn btn-sm btn-outline-primary rounded-pill px-3 shadow-sm" (click)="currentCheck = null">
          <i class="fas fa-arrow-left me-1"></i> Back to all checks
        </button>
      </div>

      <!-- Enhanced Tab Navigation -->
      <div class="mb-4">
        <ul ngbNav #nav="ngbNav" class="nav-tabs nav-fill" style="border-bottom: none;">
          <li ngbNavItem>
            <a ngbNavLink class="nav-link rounded-top" [class.active]="activeTab === 'auto'">
              <div class="d-flex flex-column align-items-center py-2 px-4" (click)="activeTab = 'auto'">
                <i class="fas fa-cloud-download-alt fs-4 mb-2"></i>
                <span>Get Results Automatically</span>
              </div>
            </a>
          </li>
          <li ngbNavItem>
            <a ngbNavLink class="nav-link rounded-top" [class.active]="activeTab === 'manual'">
              <div class="d-flex flex-column align-items-center py-2 px-4" (click)="activeTab = 'manual'">
                <i class="fas fa-keyboard fs-4 mb-2"></i>
                <span>Enter Results Manually</span>
              </div>
            </a>
          </li>
        </ul>
        <div class="border-top border-2 border-primary"></div>
      </div>

      <!-- Tab Content -->
      <div [ngSwitch]="activeTab">
        <!-- GET RESULTS FORM -->
        <div *ngSwitchCase="'auto'" class="card border-0 mb-4" style="box-shadow: 0 4px 24px rgba(0, 0, 0, 0.08);">
          <div class="card-header bg-white border-bottom-0 py-3">
            <h5 class="mb-0"><i class="fas fa-cloud-download-alt me-2 text-primary"></i> Retrieve Official Results</h5>
          </div>
          <div class="card-body">
            <form [formGroup]="examForm" (ngSubmit)="submitFormCheck()">
              <div class="row g-3">
                <div class="col-md-4">
                  <div class="form-floating">
                    <select class="form-select" id="examYear" formControlName="examYear" required
                      style="padding-top: 1.625rem; padding-bottom: 0.625rem;">
                      <option value="" disabled selected>-- Select Year --</option>
                      <option *ngFor="let year of examYears" [value]="year">{{ year }}</option>
                    </select>
                    <label for="examYear">Exam Year</label>
                    <div class="invalid-feedback"
                      *ngIf="examForm.get('examYear')?.touched && examForm.get('examYear')?.hasError('required')">
                      Please select an exam year
                    </div>
                  </div>
                </div>

                <div class="col-md-4">
                  <div class="form-floating">
                    <select class="form-select" id="examType" formControlName="examType" required
                      style="padding-top: 1.625rem; padding-bottom: 0.625rem;">
                      <option value="" disabled selected>-- Select Exam Type --</option>
                      <option *ngFor="let g of groups" [ngValue]="g.id">{{ g.name }}</option>
                    </select>
                    <label for="examType">Exam Type</label>
                    <div class="invalid-feedback"
                      *ngIf="examForm.get('examType')?.touched && examForm.get('examType')?.hasError('required')">
                      Please select an exam type
                    </div>
                  </div>
                </div>

                <div class="col-md-4">
                  <div class="form-floating">
                    <input type="text" class="form-control" id="indexNumber" placeholder="Enter Index Number"
                      formControlName="indexNumber" required>
                    <label for="indexNumber">Index Number</label>
                    <div class="invalid-feedback"
                      *ngIf="examForm.get('indexNumber')?.touched && examForm.get('indexNumber')?.hasError('required')">
                      Please enter an index number
                    </div>
                  </div>
                </div>
              </div>

              <div class="text-center mt-4">
                <button type="submit" class="btn btn-primary px-5 rounded-pill shadow-sm"
                  style="background: linear-gradient(135deg, #4e54c8, #8f94fb); border: none;"
                  (click)="submitFormCheck()">
                  <i class="fas fa-search me-2"></i> Retrieve Results
                </button>
              </div>

            </form>
          </div>

<!-- LOADING SPINNER -->
<!-- Add this right below the form in the "GET RESULTS FORM" section, before the waecresults json -->
<div *ngIf="isLoading" class="card border-0 mt-4" style="box-shadow: 0 4px 24px rgba(0, 0, 0, 0.08);">
  <div class="card-body text-center py-5">
    <div class="mb-4">
      <div class="spinner-border text-primary" style="width: 3rem; height: 3rem;" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
    </div>
    <h5 class="mb-3">Retrieving WAEC Results</h5>
    <p class="text-muted mb-4">Please wait while we fetch the official results from WAEC</p>
    
    <!-- Animated progress bar -->
    <div class="progress mb-3" style="height: 8px; border-radius: 4px;">
      <div class="progress-bar progress-bar-striped progress-bar-animated" 
           role="progressbar" 
           style="width: 100%; background: linear-gradient(135deg, #4e54c8, #8f94fb);">
      </div>
    </div>
    
    <div class="d-flex justify-content-center">
      <div class="spinner-grow text-primary mx-1" style="width: 1.5rem; height: 1.5rem;" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
      <div class="spinner-grow text-primary mx-1" style="width: 1.5rem; height: 1.5rem; animation-delay: 0.2s;" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
      <div class="spinner-grow text-primary mx-1" style="width: 1.5rem; height: 1.5rem; animation-delay: 0.4s;" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
    </div>
  </div>
</div>

<!-- {{waecresults|json}} -->


<!-- LOADING SPINNER -->


          <!-- {{waecresults|json}} -->


<!-- Results Display Section -->
<div *ngIf="waecresults" class="card border-0 mt-4" style="box-shadow: 0 4px 24px rgba(0, 0, 0, 0.08);">
  <div class="card-header bg-white border-bottom-0 py-3">
    <h5 class="mb-0"><i class="fas fa-file-alt me-2 text-primary"></i> WAEC Results for {{waecresults.cname}}</h5>
  </div>
  <div class="card-body">
    <!-- Candidate Summary -->
    <div class="row mb-4">
      <div class="col-md-4">
        <div class="d-flex align-items-center mb-3">
          <i class="fas fa-id-card me-3 text-muted fs-4"></i>
          <div>
            <h6 class="mb-0 text-muted small">Index Number</h6>
            <p class="mb-0 fw-bold">{{waecresults.cindex}}</p>
          </div>
        </div>
      </div>
      <div class="col-md-4">
        <div class="d-flex align-items-center mb-3">
          <i class="fas fa-calendar-alt me-3 text-muted fs-4"></i>
          <div>
            <h6 class="mb-0 text-muted small">Date of Birth</h6>
            <p class="mb-0 fw-bold">{{waecresults.dob}}</p>
          </div>
        </div>
      </div>
      <div class="col-md-4">
        <div class="d-flex align-items-center mb-3">
          <i class="fas fa-graduation-cap me-3 text-muted fs-4"></i>
          <div>
            <h6 class="mb-0 text-muted small">Exam Year</h6>
            <p class="mb-0 fw-bold">{{waecresults.examyear}}</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Results Table -->
    <div class="table-responsive">
      <table class="table table-hover align-middle">
        <thead class="table-light">
          <tr>
            <th class="ps-4">Subject Code</th>
            <th>Subject</th>
            <th>Grade</th>
            <th class="pe-4">Interpretation</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let result of waecresults.resultDetails">
            <td class="ps-4">{{result.subjectcode}}</td>
            <td class="fw-bold">{{result.subject}}</td>
            <td>
              <span class="badge rounded-pill py-2 px-3" 
                [ngClass]="{
                  'bg-success': result.grade === 'A1' || result.grade === 'B2' || result.grade === 'B3',
                  'bg-primary': result.grade === 'C4' || result.grade === 'C5' || result.grade === 'C6',
                  'bg-warning': result.grade === 'D7' || result.grade === 'E8',
                  'bg-danger': result.grade === 'F9'
                }">
                {{result.grade}}
              </span>
            </td>
            <td class="pe-4">{{result.interpretation}}</td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Summary and Actions -->
    <div class="d-flex justify-content-between align-items-center mt-4">
      <div>
        <span class="badge bg-light text-dark rounded-pill py-2 px-3">
          <i class="fas fa-book me-2"></i> {{waecresults.resultDetails.length}} Subjects
        </span>
      </div>
      <div>
        <button class="btn btn-primary rounded-pill shadow-sm me-2" >
          <i class="fas fa-chart-bar me-2"></i> Analyze Results
        </button>
        <button class="btn btn-outline-secondary rounded-pill shadow-sm" (click)="downloadResultsPDF()">
          <i class="fas fa-download me-2"></i> Download PDF
        </button>
      </div>
    </div>
  </div>
</div>




































































































































































































        </div>



        <!-- ADD RESULTS MANUALLY FORM -->
        <div *ngSwitchCase="'manual'" class="card border-0 mb-4" style="box-shadow: 0 4px 24px rgba(0, 0, 0, 0.08);">
          <div class="card-header bg-white border-bottom-0 py-3">
            <h5 class="mb-0"><i class="fas fa-keyboard me-2 text-primary"></i> Manual Results Entry</h5>
          </div>
          <div class="card-body">
            <form [formGroup]="entryForm">
              <!-- Primary Info Section -->
              <div class="card mb-4 border-0" style="background-color: rgba(248, 249, 250, 0.5);">
                <div class="card-body">
                  <h6 class="mb-3 text-muted"><i class="fas fa-info-circle me-2"></i> Candidate Information</h6>
                  <div class="row g-3">
                    <div class="col-md-4">
                      <div class="form-floating">
                        <input type="text" formControlName="indexNumber" class="form-control" id="manualIndexNumber"
                          placeholder="Index Number" />
                        <label for="manualIndexNumber">Index Number</label>
                      </div>
                    </div>
                    <div class="col-md-4">
                      <div class="form-floating">
                        <select class="form-select" id="examBoard" formControlName="examBoard"
                          (change)="onBoardChange($event)" style="padding-top: 1.625rem; padding-bottom: 0.625rem;">
                          <option value="" disabled selected>Choose Exam Board</option>
                          <option *ngFor="let board of examBoards" [value]="board">{{ board }}</option>
                        </select>
                        <label for="examBoard">Exam Board</label>
                      </div>
                    </div>
                    <div class="col-md-4">
                      <div class="form-floating">
                        <select class="form-select" id="manualExamYear" formControlName="examYear"
                          style="padding-top: 1.625rem; padding-bottom: 0.625rem;">
                          <option value="" disabled selected>Choose Year</option>
                          <option *ngFor="let year of examYears" [value]="year">{{ year }}</option>
                        </select>
                        <label for="manualExamYear">Exam Year</label>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Subject Entry Section -->
              <div class="card mb-4 border-0" style="background-color: rgba(248, 249, 250, 0.5);">
                <div class="card-body">
                  <h6 class="mb-3 text-muted"><i class="fas fa-book me-2"></i> Subject Details</h6>
                  <div class="row g-3">
                    <div class="col-md-3">
                      <div class="form-floating">
                        <select class="form-select" id="manualExamType" formControlName="examType"
                          style="padding-top: 1.625rem; padding-bottom: 0.625rem;">
                          <option value="" disabled selected>Choose Exam Type</option>
                          <option *ngFor="let type of availableExamTypes" [value]="type">{{ type }}</option>
                        </select>
                        <label for="manualExamType">Exam Type</label>
                      </div>
                    </div>
                    <div class="col-md-3">
                      <div class="form-floating">
                        <input type="text" formControlName="subject" class="form-control" id="subject"
                          placeholder="Select Subject" />
                        <label for="subject">Subject</label>
                      </div>
                    </div>
                    <div class="col-md-3">
                      <div class="form-floating">
                        <select class="form-select" id="grade" formControlName="grade"
                          style="padding-top: 1.625rem; padding-bottom: 0.625rem;">
                          <option value="" disabled selected>Select Grade</option>
                          <option *ngFor="let grade of grades" [value]="grade">{{ grade }}</option>
                        </select>
                        <label for="grade">Grade</label>
                      </div>
                    </div>
                    <div class="col-md-3">
                      <div class="form-floating">
                        <select class="form-select" id="sitting" formControlName="sitting"
                          style="padding-top: 1.625rem; padding-bottom: 0.625rem;">
                          <option value="" disabled selected>Select Sitting</option>
                          <option value="May/June">May/June</option>
                          <option value="Nov/Dec">Nov/Dec</option>
                        </select>
                        <label for="sitting">Sitting</label>
                      </div>
                    </div>
                  </div>

                  <div class="text-center mt-3">
                    <button type="button" class="btn btn-primary px-5 rounded-pill shadow-sm" (click)="addEntry()"
                      style="background: linear-gradient(135deg, #4e54c8, #8f94fb); border: none;">
                      <i class="fas fa-plus me-2"></i> Add Subject
                    </button>
                  </div>
                </div>
              </div>

              <!-- Entry Table -->
              <div *ngIf="entries.length > 0" class="card border-0">
                <div class="card-body px-0 pb-0">
                  <div class="table-responsive">
                    <table class="table table-hover align-middle mb-0">
                      <thead class="table-light">
                        <tr>
                          <th class="ps-4">Index No.</th>
                          <th>Exam Board</th>
                          <th>Year</th>
                          <th>Exam Type</th>
                          <th>Subject</th>
                          <th>Grade</th>
                          <th>Sitting</th>
                          <th class="pe-4 text-end">Actions</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr *ngFor="let item of entries; let i = index">
                          <td class="ps-4">{{ item.indexNumber }}</td>
                          <td>{{ item.examBoard }}</td>
                          <td>{{ item.examYear }}</td>
                          <td>{{ item.examType }}</td>
                          <td class="fw-bold">{{ item.subject }}</td>
                          <td>
                            <span class="badge rounded-pill py-1 px-3"
                              style="background: linear-gradient(135deg, #4e54c8, #8f94fb);">{{ item.grade }}</span>
                          </td>
                          <td>{{ item.sitting }}</td>
                          <td class="pe-4 text-end">
                            <button class="btn btn-sm btn-outline-danger rounded-pill shadow-sm"
                              (click)="removeEntry(i)">
                              <i class="fas fa-trash-alt me-1"></i> Delete
                            </button>
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                  <div class="text-end mt-3 pe-4">
                    <button class="btn btn-success rounded-pill px-4 shadow-sm" (click)="getFormattedResponse()"
                      style="background: linear-gradient(135deg, #28a745, #5cb85c); border: none;">
                      <i class="fas fa-check-circle me-2"></i> Submit for Interpretation
                    </button>
                  </div>
                </div>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>