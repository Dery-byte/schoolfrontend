<!-- Main Container with premium styling -->
<div class="container-fluid px-0">
  <!-- New Check Creation (shown when no active check) -->
  <div *ngIf="!currentCheck" class="eligibility-dashboard">
    <!-- Hero section for new check -->
    <div class="card new-check-card mb-5 border-0"
      style="background: linear-gradient(to right, #f8f9fa, #ffffff); box-shadow: 0 4px 24px rgba(0, 0, 0, 0.08);">
      <div class="card-header py-3"
        style="background: linear-gradient(135deg, #4e54c8, #8f94fb); border-radius: 0.375rem 0.375rem 0 0 !important;">
        <div class="d-flex justify-content-between align-items-center">
          <h4 class="mb-0 text-white"><i class="fas fa-user-graduate me-2"></i> Start New Eligibility Check</h4>
          <span class="badge bg-white text-primary rounded-pill px-3 py-2">Step 1 of 3</span>
        </div>
      </div>
      <div class="card-body px-4 py-4">
        <form [formGroup]="newCheckForm" class="needs-validation" novalidate>
          <div class="row g-3">
            <div class="col-md-6">
              <div class="form-floating">
                <input type="text" class="form-control" id="candidateName" formControlName="candidateName"
                  placeholder="Enter candidate's full name" required>
                <label for="candidateName">Candidate Name</label>
                <div class="invalid-feedback">
                  Please provide the candidate's name.
                </div>
              </div>
            </div>
            <div class="col-md-6">
              <div class="form-floating">
                <select class="form-select" id="examType" formControlName="examType" required
                  style="padding-top: 1.625rem; padding-bottom: 0.625rem;">
                  <option value="" disabled selected>-- Select Exam Type --</option>
                  <option *ngFor="let type of examTypes" [value]="type">{{type}}</option>
                </select>
                <label for="examType">Exam Type</label>
                <div class="invalid-feedback">
                  Please select an exam type.
                </div>
              </div>
            </div>
          </div>





























































          <div class="text-center mt-4">
            <!-- <button class="btn btn-primary btn-lg px-5 rounded-pill shadow-sm" (click)="initiateCheck()"
              style="background: linear-gradient(135deg, #4e54c8, #8f94fb); border: none;">
              <i class="fas fa-play-circle me-2"></i> Start New Checkss
            </button> -->



            <button class="btn btn-primary btn-lg px-5 rounded-pill shadow-sm" (click)="createRecords()"
              style="background: linear-gradient(135deg, #4e54c8, #8f94fb); border: none;">
              <i class="fas fa-play-circle me-2"></i> Start New Check
            </button>

            <button class="close-button" (click)="openPaymentModal()" aria-label="Close">
              <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                <path d="M12 4L4 12M4 4L12 12" stroke="#64748B" stroke-width="2" stroke-linecap="round" />
              </svg>
              Open Payment Modal
            </button>




            <button class="close-button" (click)="openOtpModal()" aria-label="Close">
              <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                <path d="M12 4L4 12M4 4L12 12" stroke="#64748B" stroke-width="2" stroke-linecap="round" />
              </svg>
              Open OTP Modal
            </button>


            <button class="close-button" (click)="openWebhook()" aria-label="Close">
              <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                <path d="M12 4L4 12M4 4L12 12" stroke="#64748B" stroke-width="2" stroke-linecap="round" />
              </svg>
              Open Webhook MOdal.
            </button>



          </div>
        </form>
      </div>
    </div>


    <!-- {{userChecks|json}} -->











































































    <!-- Previous Checks List -->
    <div *ngIf="userChecks.length > 0" class="card border-0 shadow-sm">
      <div class="card-header bg-white border-bottom-0 py-3">
        <div class="d-flex justify-content-between align-items-center">
          <h4 class="mb-0"><i class="fas fa-history me-2 text-muted"></i> Your Previous Checks</h4>
          <span class="badge bg-light text-dark rounded-pill">{{userChecks.length}} checks</span>
        </div>
      </div>
      <div class="card-body px-0 pb-0">
        <div class="table-responsive">
          <table class="table table-hover align-middle mb-0">
            <thead class="table-light">
              <tr>
                <th class="ps-4">Candidate</th>
                <th>Date</th>
                <th>Payment</th>
                <th>Status</th>
                <th class="pe-4 text-end">Action</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let check of userChecks" class="check-row" style="cursor: pointer;">
                <td class="ps-4 fw-bold">{{check.candidateName}}</td>
                <td>{{check.createdAt | date:'mediumDate'}}</td>
                <td>
                  <span class="badge rounded-pill py-1 px-3" [ngClass]="{
                    'bg-success-light text-success': check.paymentStatus === 'paid',
                    'bg-warning-light text-warning': check.paymentStatus === 'pending',
                    'bg-danger-light text-danger': check.paymentStatus === 'failed'
                  }">
                    <i class="fas fa-circle me-1" style="font-size: 6px; vertical-align: middle;"></i>
                    {{check.paymentStatus | titlecase}}
                  </span>
                </td>
                <td>
                  <span class="badge rounded-pill py-1 px-3" [ngClass]="{
                    'bg-success-light text-success': check.checkStatus === 'completed',
                    'bg-primary-light text-primary': check.checkStatus === 'in_progress',
                    'bg-secondary-light text-secondary': check.checkStatus === 'not_started'
                  }">
                    <i class="fas fa-circle me-1" style="font-size: 6px; vertical-align: middle;"></i>
                    {{check.checkStatus | titlecase}}
                  </span>
                </td>
                <td class="pe-4 text-end">
                  <button class="btn btn-sm rounded-pill shadow-sm" [ngClass]="{
                      'btn-outline-primary': check.paymentStatus === 'paid',
                      'btn-primary': check.paymentStatus !== 'paid'
                    }" (click)="resumeCheck(check.id)" style="min-width: 120px;">
                    {{check.paymentStatus === 'paid' ? 'Continue' : 'Pay & Continue'}}
                    <i class="fas fa-arrow-right ms-2"></i>
                  </button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>













































































  </div>






  <!-- Active Check Workflow -->
  <div *ngIf="currentCheck" class="active-check-container">
    <!-- Payment Step (shown if not paid) -->
    <div *ngIf="currentCheck.paymentStatus !== 'paid'" class="card border-0 mb-4"
      style="box-shadow: 0 4px 24px rgba(0, 0, 0, 0.08);">
      <div class="card-header py-3"
        style="background: linear-gradient(135deg, #4e54c8, #8f94fb); border-radius: 0.375rem 0.375rem 0 0 !important;">
        <div class="d-flex justify-content-between align-items-center">
          <h4 class="mb-0 text-white"><i class="fas fa-credit-card me-2"></i> Payment Required</h4>
          <span class="badge bg-white text-primary rounded-pill px-3 py-2">Step 2 of 3</span>
        </div>
      </div>
      <div class="card-body px-4 py-4">
        <div class="row">
          <div class="col-lg-8">
            <div class="alert alert-info border-0 mb-4" style="background-color: rgba(13, 110, 253, 0.1);">
              <div class="d-flex">
                <div class="flex-shrink-0">
                  <i class="fas fa-info-circle text-info mt-1 fs-4"></i>
                </div>
                <div class="flex-grow-1 ms-3">
                  <h5 class="alert-heading">What happens after payment?</h5>
                  <p class="mb-2">Once your payment is confirmed, you'll be able to:</p>
                  <ul class="mb-2 ps-3">
                    <li class="mb-2"><i class="fas fa-check-circle text-success me-2"></i> <strong>Pull WAEC results
                        automatically</strong> - Retrieve official results directly</li>
                    <li><i class="fas fa-check-circle text-success me-2"></i> <strong>OR enter results manually</strong>
                      - Input grades yourself if preferred</li>
                  </ul>
                  <hr class="my-2">
                  <p class="mb-0 small"><i class="fas fa-exclamation-circle me-2"></i><strong>Note:</strong> Both
                    options give access to comprehensive result analysis.</p>
                </div>
              </div>
            </div>
          </div>

          <div class="col-lg-4">
            <div class="payment-summary-card p-4 rounded-3 border-0"
              style="background: linear-gradient(to bottom, #ffffff, #f8f9fa); box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);">
              <h5 class="fw-bold mb-4 text-center">Payment Summary</h5>
              <div class="d-flex justify-content-between mb-2">
                <span class="text-muted">Service Fee:</span>
                <strong>GHS 5,000</strong>
              </div>
              <div class="d-flex justify-content-between mb-3">
                <span class="text-muted">Convenience Fee:</span>
                <strong>GHS 200</strong>
              </div>
              <hr class="my-3">
              <div class="d-flex justify-content-between total-amount fw-bold fs-5">
                <span>Total Amount:</span>
                <strong class="text-primary">GHS 5,200</strong>
              </div>

              <button class="btn btn-primary w-100 mt-4 py-3 rounded-pill shadow-sm" (click)="openPaymentModal()"
                style="background: linear-gradient(135deg, #4e54c8, #8f94fb); border: none;">
                <i class="fas fa-lock me-2"></i> Proceed to Secure Payment
              </button>

              <div class="text-center mt-3 small text-muted">
                <i class="fas fa-shield-alt me-2"></i> All payments are secure and encrypted
              </div>
            </div>
          </div>
        </div>

        <div class="text-center mt-4">
          <button class="btn btn-outline-secondary rounded-pill px-4 shadow-sm" (click)="cancelCurrentCheck()">
            <i class="fas fa-arrow-left me-2"></i> Back to All Checks
          </button>
        </div>
      </div>
    </div>

    <!-- Results Forms (shown after payment) -->
    <div *ngIf="currentCheck.paymentStatus === 'paid'">
      <div class="alert alert-primary border-0 mb-4 d-flex justify-content-between align-items-center py-3"
        style="background-color: rgba(13, 110, 253, 0.1);">
        <div class="d-flex align-items-center">
          <i class="fas fa-user-graduate me-3 fs-4 text-primary"></i>
          <div>
            <h6 class="mb-0">Currently processing check for:</h6>
            <strong class="fs-5">{{currentCheck.candidateName}}</strong>
          </div>
        </div>
        <button class="btn btn-sm btn-outline-primary rounded-pill px-3 shadow-sm" (click)="currentCheck = null">
          <i class="fas fa-arrow-left me-1"></i> Back to all checks
        </button>
      </div>

      <!-- Enhanced Tab Navigation -->
      <div class="mb-4">
        <ul ngbNav #nav="ngbNav" class="nav-tabs nav-fill" style="border-bottom: none;">
          <li ngbNavItem>
            <a ngbNavLink class="nav-link rounded-top" [class.active]="activeTab === 'auto'">
              <div class="d-flex flex-column align-items-center py-2 px-4" (click)="activeTab = 'auto'">
                <i class="fas fa-cloud-download-alt fs-4 mb-2"></i>
                <span>Get Results Automatically</span>
              </div>
            </a>
          </li>
          <li ngbNavItem>
            <a ngbNavLink class="nav-link rounded-top" [class.active]="activeTab === 'manual'">
              <div class="d-flex flex-column align-items-center py-2 px-4" (click)="activeTab = 'manual'">
                <i class="fas fa-keyboard fs-4 mb-2"></i>
                <span>Enter Results Manually</span>
              </div>
            </a>
          </li>
        </ul>
        <div class="border-top border-2 border-primary"></div>
      </div>

      <!-- Tab Content -->
      <div [ngSwitch]="activeTab">
        <!-- GET RESULTS FORM -->
        <div *ngSwitchCase="'auto'" class="card border-0 mb-4" style="box-shadow: 0 4px 24px rgba(0, 0, 0, 0.08);">
          <div class="card-header bg-white border-bottom-0 py-3">
            <h5 class="mb-0"><i class="fas fa-cloud-download-alt me-2 text-primary"></i> Retrieve Official Results</h5>
          </div>
          <div class="card-body">
            <form [formGroup]="examForm" (ngSubmit)="submitFormCheck()">
              <div class="row g-3">
                <div class="col-md-4">
                  <div class="form-floating">
                    <select class="form-select" id="examYear" formControlName="examYear" required
                      style="padding-top: 1.625rem; padding-bottom: 0.625rem;">
                      <option value="" disabled selected>-- Select Year --</option>
                      <option *ngFor="let year of examYears" [value]="year">{{ year }}</option>
                    </select>
                    <label for="examYear">Exam Year</label>
                    <div class="invalid-feedback"
                      *ngIf="examForm.get('examYear')?.touched && examForm.get('examYear')?.hasError('required')">
                      Please select an exam year
                    </div>
                  </div>
                </div>

                <div class="col-md-4">
                  <div class="form-floating">
                    <select class="form-select" id="examType" formControlName="examType" required
                      style="padding-top: 1.625rem; padding-bottom: 0.625rem;">
                      <option value="" disabled selected>-- Select Exam Type --</option>
                      <option *ngFor="let g of groups" [ngValue]="g.id">{{ g.name }}</option>
                    </select>
                    <label for="examType">Exam Type</label>
                    <div class="invalid-feedback"
                      *ngIf="examForm.get('examType')?.touched && examForm.get('examType')?.hasError('required')">
                      Please select an exam type
                    </div>
                  </div>
                </div>








                <div class="col-md-4"> <!-- Wider column to fit both -->
                  <div class="row g-3 ">
                    <div class="col-md-8">
                      <div class="form-floating">
                        <input type="text" class="form-control" id="indexNumber" placeholder="Enter Index Number"
                          formControlName="indexNumber" required>
                        <label for="indexNumber">Index Number</label>
                        <div class="invalid-feedback"
                          *ngIf="examForm.get('indexNumber')?.touched && examForm.get('indexNumber')?.hasError('required')">
                          Please enter an index number
                        </div>
                      </div>
                    </div>

                    <!-- Button (takes less space) -->
                    <div class="col-md-4">
                      <button type="button" class="btn btn-primary" (click)="openConfirmModal()"
                        [disabled]="examForm.get('indexNumber')?.invalid">
                        Confirm
                      </button>
                    </div>
                  </div>
                </div>




              </div>

              <div class="text-center mt-4">
                <button type="submit" class="btn btn-primary px-5 rounded-pill shadow-sm"
                  style="background: linear-gradient(135deg, #4e54c8, #8f94fb); border: none;"
                  (click)="submitFormCheck()" [disabled]="!examForm.valid  || !isIndexConfirmed">
                  <i class="fas fa-search me-2"></i> Retrieve Results
                </button>
              </div>

            </form>
          </div>
          <div *ngIf="isLoading" class="card border-0 mt-4" style="box-shadow: 0 4px 24px rgba(0, 0, 0, 0.08);">
            <div class="card-body text-center py-5">
              <div class="mb-4">
                <div class="spinner-border text-primary" style="width: 3rem; height: 3rem;" role="status">
                  <span class="visually-hidden">Loading...</span>
                </div>
              </div>
              <h5 class="mb-3">Retrieving WAEC Results</h5>
              <p class="text-muted mb-4">Please wait while we fetch the official results from WAEC</p>

              <!-- Animated progress bar -->
              <div class="progress mb-3" style="height: 8px; border-radius: 4px;">
                <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar"
                  style="width: 100%; background: linear-gradient(135deg, #4e54c8, #8f94fb);">
                </div>
              </div>

              <div class="d-flex justify-content-center">
                <div class="spinner-grow text-primary mx-1" style="width: 1.5rem; height: 1.5rem;" role="status">
                  <span class="visually-hidden">Loading...</span>
                </div>
                <!-- <div class="spinner-grow text-primary mx-1"
                  style="width: 1.5rem; height: 1.5rem; animation-delay: 0.2s;" role="status">
                  <span class="visually-hidden">Loading...</span>
                </div> -->
                <!-- <div class="spinner-grow text-primary mx-1"
                  style="width: 1.5rem; height: 1.5rem; animation-delay: 0.4s;" role="status">
                  <span class="visually-hidden">Loading...</span>
                </div> -->
              </div>
            </div>
          </div>

          <!-- {{waecresults|json}} -->



          <!-- Results Display Section -->
          <div *ngIf="waecresults" class="card border-0 mt-4" style="box-shadow: 0 4px 24px rgba(0, 0, 0, 0.08);">
            <div class="card-header bg-white border-bottom-0 py-3">
              <h5 class="mb-0"><i class="fas fa-file-alt me-2 text-primary"></i> WAEC Results for {{waecresults.cname}}
              </h5>
            </div>
            <div class="card-body">
              <!-- Candidate Summary -->
              <div class="row mb-4">
                <div class="col-md-4">
                  <div class="d-flex align-items-center mb-3">
                    <i class="fas fa-id-card me-3 text-muted fs-4"></i>
                    <div>
                      <h6 class="mb-0 text-muted small">Index Number</h6>
                      <p class="mb-0 fw-bold">{{waecresults.cindex}}</p>
                    </div>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="d-flex align-items-center mb-3">
                    <i class="fas fa-calendar-alt me-3 text-muted fs-4"></i>
                    <div>
                      <h6 class="mb-0 text-muted small">Date of Birth</h6>
                      <p class="mb-0 fw-bold">{{waecresults.dob}}</p>
                    </div>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="d-flex align-items-center mb-3">
                    <i class="fas fa-graduation-cap me-3 text-muted fs-4"></i>
                    <div>
                      <h6 class="mb-0 text-muted small">Exam Year</h6>
                      <p class="mb-0 fw-bold">{{waecresults.examyear}}</p>
                    </div>
                  </div>
                </div>
              </div>
              <!-- Results Table -->
              <div class="table-responsive">
                <table class="table table-hover align-middle">
                  <thead class="table-light">
                    <tr>
                      <th class="ps-4">Subject Code</th>
                      <th>Subject</th>
                      <th>Grade</th>
                      <th class="pe-4">Interpretation</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let result of waecresults.resultDetails">
                      <td class="ps-4">{{result.subjectcode}}</td>
                      <td class="fw-bold">{{result.subject}}</td>
                      <td>
                        <span class="badge rounded-pill py-2 px-3" [ngClass]="{
                  'bg-success': result.grade === 'A1' || result.grade === 'B2' || result.grade === 'B3',
                  'bg-primary': result.grade === 'C4' || result.grade === 'C5' || result.grade === 'C6',
                  'bg-warning': result.grade === 'D7' || result.grade === 'E8',
                  'bg-danger': result.grade === 'F9'
                }">
                          {{result.grade}}
                        </span>
                      </td>
                      <td class="pe-4">{{result.interpretation}}</td>
                    </tr>
                  </tbody>
                </table>
              </div>

              <!-- Summary and Actions -->
              <div class="d-flex justify-content-between align-items-center mt-4">
                <div>
                  <span class="badge bg-light text-dark rounded-pill py-2 px-3">
                    <i class="fas fa-book me-2"></i> {{waecresults.resultDetails.length}} Subjects
                  </span>
                </div>
                <div>
                  <button class="btn btn-primary rounded-pill shadow-sm me-2" (click)="analyzeResults()"
                    [disabled]="isCheckingEligibility">
                    <span *ngIf="!isCheckingEligibility">
                      <i class="fas fa-chart-bar me-2"></i> Check Eligibility
                    </span>
                    <span *ngIf="isCheckingEligibility">
                      <span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
                      Checking...
                    </span>
                  </button>
                  <button class="btn btn-outline-secondary rounded-pill shadow-sm" (click)="downloadResultsPDF()">
                    <i class="fas fa-download me-2"></i> Download PDF
                  </button>


                </div>
              </div>
            </div>
          </div>








          <!-- ELEGIBILITY DISPLAY STARTS -->

          <div class="eligibility-container">
            <!-- University Cards -->
            <div *ngFor="let university of elligibilityResults" class="university-card">
              <!-- University Header -->
              <div class="university-header">
                <div class="university-info">
                  <h3 class="university-name">{{ university.universityName }}</h3>
                  <div class="university-meta">
                    <span class="location">{{ university.location }}</span>
                    <span class="university-type" [class.public]="university.type === 'PUBLIC'"
                      [class.private]="university.type === 'PRIVATE'">
                      {{ university.type | lowercase }}
                    </span>
                  </div>
                </div>
              </div>

              <!-- Eligible Programs -->
              <div *ngIf="university.eligiblePrograms.length > 0" class="programs-section">
                <h4 class="section-title">
                  <span class="icon success"><i class="fas fa-check-circle"></i></span>
                  Eligible Programs
                </h4>
                <div class="programs-grid">
                  <div *ngFor="let program of university.eligiblePrograms" class="program-card success">
                    <div class="program-content">
                      <h5 class="program-name">{{ program.programName }}</h5>
                      <div class="program-badge">You qualify</div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Alternative Programs -->
              <div *ngIf="university.alternativePrograms.length > 0" class="programs-section">
                <h4 class="section-title">
                  <span class="icon warning"><i class="fas fa-info-circle"></i></span>
                  Alternative Options
                </h4>
                <div class="programs-grid">
                  <div *ngFor="let program of university.alternativePrograms" class="program-card warning">
                    <div class="program-header">
                      <h5 class="program-name">{{ program.programName }}</h5>
                      <div class="eligibility-score">
                        <div class="score-value">{{ program.percentageEligibility }}% match</div>
                        <div class="score-bar">
                          <div class="bar-fill" [style.width]="program.percentageEligibility + '%'"></div>
                        </div>
                      </div>
                    </div>

                    <div class="program-details">
                      <div class="requirements">
                        <h6>Requirements</h6>
                        <div class="grade-tags">
                          <div *ngFor="let subject of getSubjects(program.cutoffPoints)" class="grade-tag">
                            <span class="subject">{{ subject }}</span>
                            <span class="grade">{{ program.cutoffPoints[subject] }}</span>
                          </div>
                        </div>
                      </div>

                      <div class="feedback">
                        <h6>Admission Notes</h6>
                        <ul>
                          <li *ngFor="let explanation of program.explanation"
                            [class.error]="explanation.includes('Invalid') || explanation.includes('missing')"
                            [class.warning]="explanation.includes('Diff')">
                            <i class="icon"
                              [class.fa-times-circle]="explanation.includes('Invalid') || explanation.includes('missing')"
                              [class.fa-exclamation-circle]="explanation.includes('Diff')"></i>
                            {{ explanation }}
                          </li>
                        </ul>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- ELEGIBILITY DISPLAY ENDS -->
          <!-- {{elligibilityResults|json}} -->



































































          <!-- CONFIRM INDEX NUMBER MODAL -->

          <!-- Confirm Modal -->
          <div class="modal fade" id="confirmModal" tabindex="-1" aria-labelledby="confirmModalLabel"
            aria-hidden="true">
            <div class="modal-dialog">
              <div class="modal-content">

                <div class="modal-header">
                  <h5 class="modal-title" id="confirmModalLabel">Confirm Index Number</h5>
                  <button type="button" class="btn-close" (click)="closeModal()" aria-label="Close"></button>
                </div>

                <div class="modal-body">
                  <input type="text" [(ngModel)]="confirmInput" class="form-control"
                    placeholder="Re-enter Index Number">
                  <div *ngIf="showMismatchError" class="text-danger mt-2">
                    Index numbers do not match.
                  </div>
                </div>

                <div class="modal-footer">
                  <button type="button" class="btn btn-secondary" (click)="closeModal()">Cancel</button>
                  <button type="button" class="btn btn-success" (click)="verifyConfirmation()">Confirm</button>
                </div>

              </div>
            </div>
          </div>































































































































































































        </div>



        <!-- ADD RESULTS MANUALLY FORM -->
        <div *ngSwitchCase="'manual'" class="card border-0 mb-4" style="box-shadow: 0 4px 24px rgba(0, 0, 0, 0.08);">
          <div class="card-header bg-white border-bottom-0 py-3">
            <h5 class="mb-0"><i class="fas fa-keyboard me-2 text-primary"></i> Manual Results Entry</h5>
          </div>
          <div class="card-body">
            <form [formGroup]="entryForm">
              <!-- Primary Info Section -->
              <div class="card mb-4 border-0" style="background-color: rgba(248, 249, 250, 0.5);">
                <div class="card-body">
                  <h6 class="mb-3 text-muted"><i class="fas fa-info-circle me-2"></i> Candidate Information</h6>
                  <div class="row g-3">
                    <div class="col-md-4">
                      <div class="form-floating">
                        <input type="text" formControlName="indexNumber" class="form-control" id="manualIndexNumber"
                          placeholder="Index Number" />
                        <label for="manualIndexNumber">Index Number</label>
                      </div>
                    </div>
                    <div class="col-md-4">
                      <div class="form-floating">
                        <select class="form-select" id="examBoard" formControlName="examBoard"
                          (change)="onBoardChange($event)" style="padding-top: 1.625rem; padding-bottom: 0.625rem;">
                          <option value="" disabled selected>Choose Exam Board</option>
                          <option *ngFor="let board of examBoards" [value]="board">{{ board }}</option>
                        </select>
                        <label for="examBoard">Exam Board</label>
                      </div>
                    </div>
                    <div class="col-md-4">
                      <div class="form-floating">
                        <select class="form-select" id="manualExamYear" formControlName="examYear"
                          style="padding-top: 1.625rem; padding-bottom: 0.625rem;">
                          <option value="" disabled selected>Choose Year</option>
                          <option *ngFor="let year of examYears" [value]="year">{{ year }}</option>
                        </select>
                        <label for="manualExamYear">Exam Year</label>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Subject Entry Section -->
              <div class="card mb-4 border-0" style="background-color: rgba(248, 249, 250, 0.5);">
                <div class="card-body">
                  <h6 class="mb-3 text-muted"><i class="fas fa-book me-2"></i> Subject Details</h6>
                  <div class="row g-3">
                    <div class="col-md-3">
                      <div class="form-floating">
                        <select class="form-select" id="manualExamType" formControlName="examType"
                          style="padding-top: 1.625rem; padding-bottom: 0.625rem;">
                          <option value="" disabled selected>Choose Exam Type</option>
                          <option *ngFor="let type of availableExamTypes" [value]="type">{{ type }}</option>
                        </select>
                        <label for="manualExamType">Exam Type</label>
                      </div>
                    </div>
                    <div class="col-md-3">
                      <div class="form-floating">
                        <input type="text" formControlName="subject" class="form-control" id="subject"
                          placeholder="Select Subject" />
                        <label for="subject">Subject</label>
                      </div>
                    </div>
                    <div class="col-md-3">
                      <div class="form-floating">
                        <select class="form-select" id="grade" formControlName="grade"
                          style="padding-top: 1.625rem; padding-bottom: 0.625rem;">
                          <option value="" disabled selected>Select Grade</option>
                          <option *ngFor="let grade of grades" [value]="grade">{{ grade }}</option>
                        </select>
                        <label for="grade">Grade</label>
                      </div>
                    </div>
                    <div class="col-md-3">
                      <div class="form-floating">
                        <select class="form-select" id="sitting" formControlName="sitting"
                          style="padding-top: 1.625rem; padding-bottom: 0.625rem;">
                          <option value="" disabled selected>Select Sitting</option>
                          <option value="May/June">May/June</option>
                          <option value="Nov/Dec">Nov/Dec</option>
                        </select>
                        <label for="sitting">Sitting</label>
                      </div>
                    </div>
                  </div>

                  <div class="text-center mt-3">
                    <button type="button" class="btn btn-primary px-5 rounded-pill shadow-sm" (click)="addEntry()"
                      style="background: linear-gradient(135deg, #4e54c8, #8f94fb); border: none;">
                      <i class="fas fa-plus me-2"></i> Add Subject
                    </button>
                  </div>
                </div>
              </div>

              <!-- Entry Table -->
              <div *ngIf="entries.length > 0" class="card border-0">
                <div class="card-body px-0 pb-0">
                  <div class="table-responsive">
                    <table class="table table-hover align-middle mb-0">
                      <thead class="table-light">
                        <tr>
                          <th class="ps-4">Index No.</th>
                          <th>Exam Board</th>
                          <th>Year</th>
                          <th>Exam Type</th>
                          <th>Subject</th>
                          <th>Grade</th>
                          <th>Sitting</th>
                          <th class="pe-4 text-end">Actions</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr *ngFor="let item of entries; let i = index">
                          <td class="ps-4">{{ item.indexNumber }}</td>
                          <td>{{ item.examBoard }}</td>
                          <td>{{ item.examYear }}</td>
                          <td>{{ item.examType }}</td>
                          <td class="fw-bold">{{ item.subject }}</td>
                          <td>
                            <span class="badge rounded-pill py-1 px-3"
                              style="background: linear-gradient(135deg, #4e54c8, #8f94fb);">{{ item.grade }}</span>
                          </td>
                          <td>{{ item.sitting }}</td>
                          <td class="pe-4 text-end">
                            <button class="btn btn-sm btn-outline-danger rounded-pill shadow-sm"
                              (click)="removeEntry(i)">
                              <i class="fas fa-trash-alt me-1"></i> Delete
                            </button>
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                  <div class="text-end mt-3 pe-4">
                    <button class="btn btn-success rounded-pill px-4 shadow-sm" (click)="getFormattedResponse()"
                      style="background: linear-gradient(135deg, #28a745, #5cb85c); border: none;">
                      <i class="fas fa-check-circle me-2"></i> Submit for Interpretation
                    </button>
                  </div>
                </div>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>





























































<!-- //MODAL HTML TEMPLATE -->

<div class="modal-backdrop" *ngIf="showPaymentModal">
  <div class="payment-modal">
    <div class="modal-content-container">
      <!-- Header with progress indicator -->
      <div class="modal-header">
        <div class="progress-step active">Complete Payment</div>
        <button class="close-button" (click)="closePaymentModal()" aria-label="Close">
          <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
            <path d="M12 4L4 12M4 4L12 12" stroke="#64748B" stroke-width="2" stroke-linecap="round" />
          </svg>
        </button>
      </div>
      <form [formGroup]="paymentForm" (ngSubmit)="submitPayment()">
        <div class="form-scroll-container">
          <h3 class="section-title">Payment Amount</h3>
          <div class="form-group amount-group">
            <div class="currency-prefix">GHS</div>
            <input type="number" class="form-control" id="amount" placeholder="0.00" formControlName="amount"
              [readonly]="isAmountFixed" min="0.01" step="0.01" autofocus (blur)="validateAmount()" />
          </div>
          <h3 class="section-title">Mobile Money Details</h3>
          <div class="form-group">
            <label for="mobileNumber">Phone Number</label>
            <div class="input-with-select">
              <select formControlName="channel" class="network-select" required>
                <option value="" disabled selected>Select Network</option>
                <option value="13">MTN</option>
                <option value="6">Vodafone</option>
                <option value="7">AirtelTigo</option>
              </select>
              <input type="tel" id="mobileNumber" formControlName="payer" placeholder="0244 123 456"
                class="phone-input">
            </div>
            <!-- Add validation message -->
            <div *ngIf="paymentForm.get('channel')?.invalid && paymentForm.get('channel')?.touched"
              class="error-message">
              Please select a mobile network
            </div>
          </div>
          <div class="info-box">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
              <path
                d="M8 14C11.3137 14 14 11.3137 14 8C14 4.68629 11.3137 2 8 2C4.68629 2 2 4.68629 2 8C2 11.3137 4.68629 14 8 14Z"
                fill="#EFF6FF" stroke="#3B82F6" />
              <path d="M8 5V8" stroke="#3B82F6" stroke-width="2" stroke-linecap="round" />
              <path d="M8 11H8.01" stroke="#3B82F6" stroke-width="2" stroke-linecap="round" />
            </svg>
            <p>You'll receive a payment request on your phone</p>
          </div>
        </div>
        <div class="modal-footer">
          <button type="submit" class="submit-button" [disabled]="!paymentForm.valid">
            <span *ngIf="!processingPayment">Pay GHS {{paymentForm.get('amount')?.value | number:'1.2-2'}}</span>
            <span *ngIf="processingPayment" class="processing">
              <svg class="spinner" viewBox="0 0 50 50">
                <circle cx="25" cy="25" r="20" fill="none" stroke-width="4"></circle>
              </svg>
              Processing...
            </span>
          </button>
        </div>
      </form>
    </div>
  </div>
</div>



























































<!-- OTP VERIFICATION MODAL -->
<div class="modal-backdrop" *ngIf="showOtpModal" @fadeInOut>
  <div class="otp-modal">
    <div class="modal-content-container">
      <!-- Header with close button -->
      <div class="modal-header">
        <h2 class="modal-title">Verify Payment</h2>
        <button class="close-button" (click)="closeOtpModal()" aria-label="Close">
          <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
            <path d="M12 4L4 12M4 4L12 12" stroke="#64748B" stroke-width="2" stroke-linecap="round" />
          </svg>
        </button>
      </div>

      <form [formGroup]="otpForm" (ngSubmit)="verifyOTP()">
        <div class="form-container">
          <!-- OTP Instructions -->
          <div class="otp-instructions">
            <p>We've sent a 6-digit verification code to your phone number ending with
              <strong>{{lastFourDigits}}</strong></p>
          </div>

          <!-- OTP Input Fields -->
          <div class="otp-input-group">
            <ng-container *ngFor="let field of [0,1,2,3,4,5]; let i = index">
              <input #otpInput type="text" maxlength="1" class="otp-digit"
                [class.error]="otpForm.get('digit'+i)?.invalid && otpForm.get('digit'+i)?.touched"
                formControlName="digit{{i}}" (input)="handleInput($event, i)" (keydown)="handleKeyDown($event, i)"
                (paste)="handlePaste($event)" autocomplete="one-time-code" inputmode="numeric" pattern="[0-9]*">
            </ng-container>

          </div>

          <!-- Error Message -->
          <div *ngIf="otpError" class="error-message">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
              <path
                d="M8 14C11.3137 14 14 11.3137 14 8C14 4.68629 11.3137 2 8 2C4.68629 2 2 4.68629 2 8C2 11.3137 4.68629 14 8 14Z"
                fill="#FEF2F2" stroke="#EF4444" />
              <path d="M8 5V9" stroke="#EF4444" stroke-width="2" stroke-linecap="round" />
              <path d="M8 12H8.01" stroke="#EF4444" stroke-width="2" stroke-linecap="round" />
            </svg>
            {{otpError}}
          </div>

          <!-- Resend OTP Option -->
          <div class="otp-resend">
            <p>Didn't receive the code?
              <button type="button" class="resend-link" (click)="resendOTP()" [disabled]="resendCooldown > 0">
                Resend {{resendCooldown > 0 ? '(' + resendCooldown + 's)' : ''}}
              </button>
            </p>
          </div>
        </div>

        <!-- Submit Button -->
        <div class="modal-footer">
          <button type="submit" class="submit-button" [disabled]="otpForm.invalid || verifyingOTP">
            <span *ngIf="!verifyingOTP">Verify Payment</span>
            <span *ngIf="verifyingOTP" class="processing">
              <svg class="spinner" viewBox="0 0 50 50">
                <circle cx="25" cy="25" r="20" fill="none" stroke-width="4"></circle>
              </svg>
              Verifying...
            </span>
          </button>
        </div>
      </form>
    </div>
  </div>
</div>




























<!-- WAITING FOR WEBHOOK- to update payment Status -->
<div class="modal-backdrop" *ngIf="showWebHook">

  <!-- <div class="payment-status-modal" [class.show]="showWebHook"> -->
  <div  (click)="closeModal()"></div>
  
  <div class="modal-card" >
    <!-- Processing State -->
    <div class="modal-body" *ngIf="!paymentCompleted">
      <div class="processing-header">
        <div class="spinner-container">
          <div class="spinner"></div>
        </div>
        <h3 class="modal-title">Complete Payment on Your Phone</h3>
      </div>
      
      <div class="payment-instructions">
        <p class="instruction-text">Please approve the payment request on your mobile device to continue</p>
        <div class="countdown-timer">
          <svg width="24" height="24" viewBox="0 0 24 24">
            <path fill="currentColor" d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"/>
            <path fill="currentColor" d="M12.5 7H11v6l5.25 3.15.75-1.23-4.5-2.67z"/>
          </svg>
          <span>Waiting for confirmation...</span>
        </div>
      </div>
      
      <div class="payment-details">
        <div class="detail-row">
          <span class="detail-label">Reference:</span>
          <span class="detail-value">{{ statusData?.data }}</span>
        </div>
        <div class="detail-row">
          <span class="detail-label">Amount:</span>
          <span class="detail-value">{{ amount | currency }}</span>
        </div>
      </div>
    </div>
    
    <!-- Success State -->
    <div class="modal-body success-state" *ngIf="paymentCompleted">
      <div class="success-animation">
        <svg class="checkmark" viewBox="0 0 52 52">
          <circle class="checkmark-circle" cx="26" cy="26" r="25" fill="none"/>
          <path class="checkmark-check" fill="none" d="M14.1 27.2l7.1 7.2 16.7-16.8"/>
        </svg>
      </div>
      
      <h3 class="modal-title">Payment Successful!</h3>
      <p class="success-message">{{ webhookResponse?.message || 'Your payment has been processed successfully' }}</p>
      
      <div class="payment-details success-details">
        <div class="detail-row">
          <span class="detail-label">Reference:</span>
          <span class="detail-value">{{ statusData?.data }}</span>
        </div>
        <div class="detail-row">
          <span class="detail-label">Amount:</span>
          <span class="detail-value">{{ amount | currency }}</span>
        </div>
        <div class="detail-row" *ngIf="webhookResponse?.transactionId">
          <span class="detail-label">Transaction ID:</span>
          <span class="detail-value">{{ webhookResponse.transactionId }}</span>
        </div>
      </div>
      
      <button class="action-button" (click)="closeModal()">
        Done
      </button>
    </div>
  </div>
</div>
<!-- </div> -->