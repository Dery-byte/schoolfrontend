{{universities | json}}

<div class="col-md-12">
  <div class="card">
    <div class="card-header d-flex justify-content-between align-items-center flex-wrap gap-2 sticky-top bg-white z-3"
      style="top: 0">
      <h4 class="card-title mb-0">University List</h4>
      <!-- University Type -->
      <select class="form-control w-auto" [(ngModel)]="selectedType">
        <option value="ALL">All Universities</option>
        <option value="PUBLIC">Public Universities</option>
        <option value="PRIVATE">Private Universities</option>
      </select>

      <!-- University Search -->
      <input type="text" class="form-control w-auto" placeholder="Search University" [(ngModel)]="universitySearch" />

      <!-- Program Search -->
      <input type="text" class="form-control w-auto" placeholder="Search Program" [(ngModel)]="programSearch" />
    </div>

    <div class="card-body">
      <!-- Modern Loading Spinner -->
      <div *ngIf="isLoadingUniversities" class="loading-overlay">
        <div class="loading-content">
          <!-- Modern spinner with SVG animation -->
          <svg class="spinner" width="65px" height="65px" viewBox="0 0 66 66" xmlns="http://www.w3.org/2000/svg">
            <circle class="path" fill="none" stroke-width="6" stroke-linecap="round" cx="33" cy="33" r="30"></circle>
          </svg>

          <!-- Loading text with fade animation -->
          <div class="loading-text">
            <span class="loading-text-words">L</span>
            <span class="loading-text-words">O</span>
            <span class="loading-text-words">A</span>
            <span class="loading-text-words">D</span>
            <span class="loading-text-words">I</span>
            <span class="loading-text-words">N</span>
            <span class="loading-text-words">G</span>
          </div>

          <!-- Optional progress indicator -->
          <div class="progress-indicator">Fetching universities and Programs...</div>
        </div>
      </div>


      <div *ngIf="!isLoadingUniversities">
        <div *ngIf="filteredUniversities.length > 0; else noUniversity">
          <div *ngFor="let university of filteredUniversities" class="mb-4 border rounded p-3 shadow-sm">
            <h5>
              {{ university.name }}
              <span class="badge bg-secondary">{{ university.type }}</span>
            </h5>
            <p class="mb-2">
              <strong>Location:</strong> {{ university.location }}
            </p>

            <h6 class="text-muted">Programs Offered</h6>

            <ng-container *ngIf="
                university.programs && university.programs.length > 0;
                else noPrograms
              ">
              <ul class="list-group">
                <li *ngFor="
                    let program of getVisiblePrograms(university);
                    let i = index
                  " class="list-group-item">
                  <div class="d-flex justify-content-between align-items-center flex-wrap">
                    <div>
                      <strong>{{ i + 1 }}. {{ program.name }}</strong>
                    </div>
                    <div class="form-button-action">













                      <button type="button" class="btn btn-link btn-sm btn-primary" title="Edit Program"
                        (click)="openUpdateModal(program.id)">
                        <i class="fa fa-edit"></i>
                      </button>























                      <button type="button" class="btn btn-link btn-sm btn-danger" title="Delete Program"
                        (click)="onDeleteProgram(program)">
                        <i class="fa fa-times"></i>
                      </button>
                    </div>
                  </div>


































                  <!-- Core & Alternative Subjects Section -->
                  <!-- Core & Alternative Subjects Section -->
<div class="mt-3">

  <!-- Buttons Row -->
  <div class="d-flex align-items-center gap-2 flex-wrap">
    <button class="btn btn-outline-primary btn-sm d-flex align-items-center"
            type="button"
            (click)="toggleCoreSubjects(program)">
      <i class="fas" [ngClass]="{ 'fa-chevron-down': !program.showCoreSubjects, 'fa-chevron-up': program.showCoreSubjects }"></i>
      <span class="ms-2">Core Subjects</span>
    </button>

    <button class="btn btn-outline-secondary btn-sm d-flex align-items-center"
            type="button"
            (click)="toggleAlternativeSubjects(program)">
      <i class="fas" [ngClass]="{ 'fa-chevron-down': !program.showAlternativeSubjects, 'fa-chevron-up': program.showAlternativeSubjects }"></i>
      <span class="ms-2">Alternative Subjects</span>
    </button>
  </div>




  <!-- Toggle Content Section -->
  <!-- Toggle Content Section -->
<div class="mt-2">

  <!-- Core Subjects -->
  <div *ngIf="program.showCoreSubjects" class="subject-list mt-3 fade-in">
    <strong class="d-block mb-2">Core Subjects:</strong>
    <div class="inline-subjects flex-wrap">
      <div *ngFor="let subject of getSubjects(program.coreSubjects)"
           class="inline-item d-flex align-items-center me-3 mb-2">
        <span class="subject-name me-2">{{ subject }}</span>
        <span class="badge bg-primary rounded-pill">{{ program.coreSubjects[subject] }}</span>
      </div>
    </div>
  </div>

  <!-- Alternative Subjects -->
  <div *ngIf="program.showAlternativeSubjects" class="subject-list mt-3 fade-in">
    <strong class="d-block mb-2">Alternative Subjects:</strong>
    <div class="inline-subjects flex-wrap">
      <div *ngFor="let subject of getSubjects(program.alternativeSubjects)"
           class="inline-item d-flex align-items-center me-3 mb-2">
        <span class="subject-name me-2">{{ subject }}</span>
        <span class="badge bg-secondary rounded-pill">{{ program.alternativeSubjects[subject] }}</span>
      </div>
    </div>
  </div>

</div>






</div>



















                </li>
              </ul>
            </ng-container>

            <ng-template #noPrograms>
              <div class="alert alert-info mt-2">
                No programs offered by this university.
              </div>
            </ng-template>

            <div *ngIf="university.programs.length > maxVisiblePrograms">
              <button class="btn btn-sm btn-outline-secondary mt-2" (click)="toggleShowAll(university)">
                {{
                showAll[university.id]
                ? 'Show Less'
                : 'Show All (' + university.programs.length + ')'
                }}
              </button>
            </div>
          </div>
        </div>
      </div>

      <ng-template #noUniversity>
        <div class="alert alert-warning text-center">
          No universities available for the selected filters.
        </div>
      </ng-template>
    </div>





  </div>
</div>






























































































































































































<!-- Edit Program Modal -->
<!--  
<div class="modal-overlay" *ngIf="showUpdateProgramModal">
  <div class="reset-form-container program-form-container">
    <div class="reset-form-header">
      <h2>Update Program</h2>
      <button class="modal-close" (click)="closeUpdateModal()" aria-label="Close">
        &times;
      </button>
    </div>

    <form [formGroup]="updateProgramForm" (ngSubmit)="updateProgram()" class="container-fluid">
      <div class="card">
        <div class="card-body">
          <div class="row">
            <div class="form-group col-12 col-md-6">
              <label for="programName">Program Name</label>
              <input type="text" class="form-control" id="programName" formControlName="programName"
                placeholder="Enter Program Name" />
              <div
                *ngIf="updateProgramForm.get('programName')?.touched && updateProgramForm.get('programName')?.invalid">
                <small *ngIf="updateProgramForm.get('programName')?.errors?.['required']" class="text-danger">
                  Program name is required.
                </small>
                <small *ngIf="updateProgramForm.get('programName')?.errors?.['minlength']" class="text-danger">
                  Minimum 3 characters.
                </small>
              </div>
            </div>

            <div class="form-group col-12 col-md-6">
              <label for="category">Category</label>
              <select class="form-select" id="category" formControlName="categoryIds">
                <option value="">-- Select Category --</option>
                <option *ngFor="let cat of colleges" [value]="cat.id">
                  {{ cat.name }}
                </option>
              </select>
              <div
                *ngIf="updateProgramForm.get('categoryIds')?.touched && updateProgramForm.get('categoryIds')?.invalid">
                <small class="text-danger">Category is Required.</small>
              </div>
            </div>
          </div>







          <div formArrayName="cutoffPoints" class="mt-3">
            <h5>Cutoff Points</h5>
            <div *ngFor="let cutoffControl of cutoffPoints.controls; let i = index" [formGroupName]="i"
              class="row g-2 mb-2">
              <div class="col-md-5">
                <select class="form-select" formControlName="subject">
                  <option value="">-- Select Subject --</option>
                  <option *ngFor="let s of combinedSubjects" [ngValue]="s">
                    {{ s }}
                  </option>
                </select>
              </div>
              <div class="col-md-5">
                <select class="form-select" formControlName="grade">
                  <option value="">-- Select Grade --</option>
                  <option *ngFor="let g of grades" [ngValue]="g">
                    {{ g }}
                  </option>
                </select>
              </div>
              <div class="col-md-2">
                <button type="button" class="btn btn-danger w-100" (click)="removeSubject(i)"> <i
                    class="fa fa-times"></i>
                </button>
              </div>
            </div>
          </div>





          
          <div class="row mt-3 g-2">
            <div class="col-md-6">
              <button type="button" class="btn btn-secondary w-100" (click)="addSubject()">+ Add Subject</button>
            </div>
            <div class="col-md-6">
              <button type="submit" class="btn btn-primary w-100" [disabled]="isUpdating">
                {{ isUpdating ? 'Updating...' : 'Update Program' }}
              </button>
            </div>
          </div>
        </div>
      </div>
    </form>
  </div>
</div> -->





<div class="modal-overlay" *ngIf="showUpdateProgramModal">
  <div class="reset-form-container program-form-container">
    <div class="reset-form-header">
      <h2>Update Program</h2>
      <button class="modal-close" (click)="closeUpdateModal()" aria-label="Close">
        &times;
      </button>
    </div>

    <form [formGroup]="updateProgramForm" (ngSubmit)="updateProgram()" class="container-fluid">
      <div class="card">
        <div class="card-body">
          <div class="row">
            <div class="form-group col-12 col-md-6">
              <label for="programName">Program Name</label>
              <input type="text" class="form-control" id="programName" formControlName="programName"
                placeholder="Enter Program Name" />
              <div
                *ngIf="updateProgramForm.get('programName')?.touched && updateProgramForm.get('programName')?.invalid">
                <small *ngIf="updateProgramForm.get('programName')?.errors?.['required']" class="text-danger">
                  Program name is required.
                </small>
                <small *ngIf="updateProgramForm.get('programName')?.errors?.['minlength']" class="text-danger">
                  Minimum 3 characters.
                </small>
              </div>
            </div>

            <div class="form-group col-12 col-md-6">
              <label for="category">Category</label>
              <select class="form-select" id="category" formControlName="categoryIds">
                <option value="">-- Select Category --</option>
                <option *ngFor="let cat of colleges" [value]="cat.id">
                  {{ cat.name }}
                </option>
              </select>
              <div
                *ngIf="updateProgramForm.get('categoryIds')?.touched && updateProgramForm.get('categoryIds')?.invalid">
                <small class="text-danger">Category is Required.</small>
              </div>
            </div>
          </div>







          <!-- <div formArrayName="cutoffPoints" class="mt-3">
            <h5>Cutoff Points</h5>
            <div *ngFor="let cutoffControl of cutoffPoints.controls; let i = index" [formGroupName]="i"
              class="row g-2 mb-2">
              <div class="col-md-5">
                <select class="form-select" formControlName="subject">
                  <option value="">-- Select Subject --</option>
                  <option *ngFor="let s of combinedSubjects" [ngValue]="s">
                    {{ s }}
                  </option>
                </select>
              </div>
              <div class="col-md-5">
                <select class="form-select" formControlName="grade">
                  <option value="">-- Select Grade --</option>
                  <option *ngFor="let g of grades" [ngValue]="g">
                    {{ g }}
                  </option>
                </select>
              </div>
              <div class="col-md-2">
                <button type="button" class="btn btn-danger w-100" (click)="removeSubject(i)"> <i
                    class="fa fa-times"></i>
                </button>
              </div>
            </div>
          </div>

 -->

          <!-- Core Subjects -->

          <!-- Core Subjects Section -->
          <div formArrayName="coreSubjects" class="mt-3">
            <div class="d-flex justify-content-between align-items-center mb-2">
              <h5 class="mb-0">Core Subjects</h5>
              <button type="button" class="btn btn-sm btn-primary" (click)="addCoreSubject()">
                <i class="fa fa-plus"></i> Add Core Subject
              </button>
            </div>

            <div *ngFor="let coreControl of coreSubjects.controls; let i = index" [formGroupName]="i"
              class="row g-2 mb-2">
              <div class="col-md-5">
                <select class="form-select" formControlName="subject">
                  <option value="">-- Select Core Subject --</option>
                  <option *ngFor="let s of combinedSubjects" [value]="s">{{ s }}</option>
                </select>
                <div *ngIf="programFormSubmitted && coreControl.get('subject')?.invalid" class="text-danger small mt-1">
                  Subject is required
                </div>
              </div>
              <div class="col-md-5">
                <select class="form-select" formControlName="grade">
                  <option value="">-- Select Grade --</option>
                  <option *ngFor="let g of grades" [value]="g">{{ g }}</option>
                </select>
                <div *ngIf="programFormSubmitted && coreControl.get('grade')?.invalid" class="text-danger small mt-1">
                  Grade is required
                </div>
              </div>
              <div class="col-md-2">
                <button type="button" class="btn btn-danger w-100" (click)="coreSubjects.removeAt(i)">
                  <i class="fa fa-times"></i>
                </button>
              </div>
            </div>

            <div *ngIf="coreSubjects.length === 0" class="alert alert-info">
              No core subjects added yet. Click "Add Core Subject" to add one.
            </div>
          </div>

          <!-- Alternative Subjects Section -->
          <div formArrayName="alternativeSubjects" class="mt-4">
            <div class="d-flex justify-content-between align-items-center mb-2">
              <h5 class="mb-0">Alternative Subjects</h5>
              <button type="button" class="btn btn-sm btn-primary" (click)="addAlternativeSubject()">
                <i class="fa fa-plus"></i> Add Subject
              </button>
            </div>

            <div *ngFor="let altControl of alternativeSubjects.controls; let i = index" [formGroupName]="i"
              class="row g-2 mb-2">
              <div class="col-md-5">
                <select class="form-select" formControlName="subject">
                  <option value="">-- Select Alternative Subject --</option>
                  <option *ngFor="let s of combinedSubjects" [value]="s">{{ s }}</option>
                </select>
                <div *ngIf="programFormSubmitted && altControl.get('subject')?.invalid" class="text-danger small mt-1">
                  Subject is required
                </div>
              </div>
              <div class="col-md-5">
                <select class="form-select" formControlName="grade">
                  <option value="">-- Select Grade --</option>
                  <option *ngFor="let g of grades" [value]="g">{{ g }}</option>
                </select>
                <div *ngIf="programFormSubmitted && altControl.get('grade')?.invalid" class="text-danger small mt-1">
                  Grade is required
                </div>
              </div>
              <div class="col-md-2">
                <button type="button" class="btn btn-danger w-100" (click)="alternativeSubjects.removeAt(i)">
                  <i class="fa fa-times"></i>
                </button>
              </div>
            </div>

            <div *ngIf="alternativeSubjects.length === 0" class="alert alert-info">
              No alternative subjects added yet. Click "Add Alternative Subject" to add one.
            </div>
          </div>





          <div class="row mt-3 g-2">
            <div class="col-md-6">
              <button type="button" class="btn btn-secondary w-100" (click)="addSubject()">+ Add Subject</button>
            </div>
            <div class="col-md-6">
              <button type="submit" class="btn btn-primary w-100" [disabled]="isUpdating">
                {{ isUpdating ? 'Updating...' : 'Update Program' }}
              </button>
            </div>
          </div>
        </div>
      </div>
    </form>
  </div>
</div>