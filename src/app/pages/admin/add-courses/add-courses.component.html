<form [formGroup]="programForm" (ngSubmit)="submitForm()" class="container-fluid modern-form">
  <div class="card modern-card">
    <div class="card-header modern-card-header">
      <div class="card-title">Add University Program</div>
    </div>

    <div class="card-body modern-card-body">
      <div class="row">
        <div class="form-group col-12 col-md-6">
          <label for="programName" class="form-label">Program Name</label>
          <input type="text" class="form-control modern-input" id="programName" formControlName="programName"
            placeholder="Enter Program Name" />
          <small *ngIf="programForm.get('programName')?.touched && programForm.get('programName')?.invalid"
            class="text-danger error-message">
            Program name is required (min. 3 characters)
          </small>
        </div>

        <div class="form-group col-12 col-md-6">
          <label for="uniType" class="form-label">Select University Type</label>
          <select class="form-select modern-select" id="uniType" formControlName="uniType"
            (change)="filterUniversities()">
            <option value="">-- All --</option>
            <option value="PUBLIC">PUBLIC</option>
            <option value="PRIVATE">PRIVATE</option>
          </select>
          <small *ngIf="programForm.get('uniType')?.touched && programForm.get('uniType')?.invalid"
            class="text-danger error-message">
            Please select a university type.
          </small>
        </div>
      </div>

      <!-- ========== University & Category Row ========== -->
      <div class="row mt-4">
        <div class="form-group col-12 col-md-6">
          <label for="universityId" class="form-label">University</label>
          <select class="form-select modern-select" id="universityId" formControlName="universityId">
            <option value="">-- Select University --</option>
            <option *ngFor="let uni of filteredUniversities" [value]="uni.id">{{ uni.name }}</option>
          </select>
        </div>

        <div class="form-group col-12 col-md-6">
          <label for="category" class="form-label">Category</label>
          <select class="form-select modern-select" id="category" formControlName="categoryIds"
            (change)="onCategoryChange($event)">
            <option value="">-- Select Category --</option>
            <option *ngFor="let cat of colleges" [value]="cat.id">{{ cat.name }}</option>
          </select>
          <small *ngIf="programForm.get('categoryIds')?.touched && programForm.get('categoryIds')?.invalid"
            class="text-danger error-message">
            Category is required.
          </small>
        </div>
      </div>

      
      <!-- ========== Core Subjects ========== -->
      <div formArrayName="coreSubjects" class="mt-4 subject-section">
        <h5 class="section-title">
          <i class="fas fa-book section-icon"></i>
          Core Subjects
        </h5>
        <div *ngFor="let coreControl of coreSubjects.controls; let i = index" [formGroupName]="i"
          class="row g-3 mb-3 subject-row">
          <div class="col-md-5">
            <select class="form-select modern-select" formControlName="subject">
              <option value="">-- Select Core Subject --</option>
              <option *ngFor="let s of combinedSubjects" [value]="s">{{ s }}</option>
            </select>
            <small *ngIf="coreControl.get('subject')?.touched && coreControl.get('subject')?.invalid"
              class="text-danger">
              Subject is required.
            </small>
          </div>
          <div class="col-md-5">
            <select class="form-select modern-select" formControlName="grade">
              <option value="">-- Select Grade --</option>
              <option *ngFor="let g of grades" [value]="g">{{ g }}</option>
            </select>
            <small *ngIf="coreControl.get('grade')?.touched && coreControl.get('grade')?.invalid" class="text-danger">
              Grade is required.
            </small>
          </div>
          <div class="col-md-2">
            <button type="button" class="btn btn-danger modern-btn-danger w-100" (click)="removeCoreSubject(i)">
              <i class="fas fa-times"></i>
            </button>
          </div>
        </div>
        <button type="button" class="btn btn-outline-primary modern-btn-outline w-100 mt-3" (click)="addCoreSubject()">
          <i class="fas fa-plus me-2"></i>Add Core Subject
        </button>
      </div>




<!-- ========== Alternative Subject Groups ========== -->
<div formArrayName="alternativeGroups" class="mt-4 subject-section">
  <h5 class="section-title mb-4">
    <i class="fas fa-layer-group section-icon me-2"></i>
    Alternative Subject Groups
    <small class="text-muted d-block mt-2 fs-6 fw-normal" style="line-height: 1.5;">
      Create groups where students can choose subjects based on conditions
    </small>
  </h5>

  <div
    *ngFor="let groupControl of alternativeGroups.controls; let i = index"
    [formGroupName]="i"
    class="card shadow-sm border-0 mb-4 overflow-hidden"
    style="border-radius: 16px; transition: transform 0.2s ease, box-shadow 0.2s ease;"
    onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 24px rgba(0,0,0,0.12)';"
    onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 6px rgba(0,0,0,0.07)';"
  >
    <!-- Group Header -->
    <div class="card-header d-flex justify-content-between align-items-center" 
         style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 1.25rem 1.5rem; border: none;">
      <div class="text-white d-flex align-items-center">
        <div class="bg-white bg-opacity-25 rounded-3 p-2 me-3" style="backdrop-filter: blur(10px);">
          <i class="fas fa-folder-open" style="font-size: 1.1rem;"></i>
        </div>
        <div>
          <strong style="font-size: 1.05rem; display: block; margin-bottom: 2px;">Alternative Group {{ i + 1 }}</strong>
          <span class="badge bg-white text-primary" style="font-size: 0.75rem; font-weight: 600; padding: 0.35rem 0.75rem; border-radius: 20px;">
            {{ getSubjects(groupControl).length }} 
            {{ getSubjects(groupControl).length === 1 ? 'Subject' : 'Subjects' }}
          </span>
        </div>
      </div>
      <button
        type="button"
        class="btn btn-sm text-white border-0"
        (click)="removeAlternativeGroup(i)"
        title="Remove this group"
        style="background: rgba(255,255,255,0.2); padding: 0.5rem 1rem; border-radius: 8px; transition: all 0.2s;"
        onmouseover="this.style.background='rgba(255,255,255,0.3)';"
        onmouseout="this.style.background='rgba(255,255,255,0.2)';"
      >
        <i class="fas fa-trash me-1"></i> Remove
      </button>
    </div>

    <div class="card-body p-4" style="background: #fafbfc;">
      <!-- Group Configuration -->
      <div class="row g-4 mb-4">
        <div class="col-md-6">
          <label class="form-label fw-semibold d-flex align-items-center mb-2" style="color: #2d3748; font-size: 0.95rem;">
            <div class="bg-warning bg-opacity-10 rounded-circle p-2 me-2">
              <i class="fas fa-star text-warning" style="font-size: 0.85rem;"></i>
            </div>
            Required Grade
          </label>
          <select class="form-select form-select-lg border-2" formControlName="requiredGrade" 
                  style="border-color: #e2e8f0; border-radius: 10px; padding: 0.75rem 1rem; font-size: 0.95rem; transition: all 0.2s;"
                  onfocus="this.style.borderColor='#667eea'; this.style.boxShadow='0 0 0 3px rgba(102,126,234,0.1)';"
                  onblur="this.style.borderColor='#e2e8f0'; this.style.boxShadow='none';">
            <option value="">-- Select Minimum Grade --</option>
            <option *ngFor="let g of grades" [value]="g">{{ g }}</option>
          </select>
          <small class="text-muted mt-2 d-block" style="font-size: 0.8rem; line-height: 1.4;">
            <i class="fas fa-info-circle me-1"></i>
            Minimum grade required to access this group
          </small>
        </div>
        
        <div class="col-md-6">
          <label class="form-label fw-semibold d-flex align-items-center mb-2" style="color: #2d3748; font-size: 0.95rem;">
            <div class="bg-info bg-opacity-10 rounded-circle p-2 me-2">
              <i class="fas fa-sliders-h text-info" style="font-size: 0.85rem;"></i>
            </div>
            Selection Condition
          </label>
          <div class="card border-0 p-3" style="background: linear-gradient(135deg, #e0e7ff 0%, #f3e8ff 100%); border-radius: 10px;">
            <div class="form-check form-switch d-flex align-items-center">
              <input
                class="form-check-input"
                type="checkbox"
                formControlName="anyOf"
                [id]="'anyOf' + i"
                style="width: 3em; height: 1.5em; cursor: pointer; border: 2px solid #cbd5e0;"
              />
              <label class="form-check-label ms-3 mb-0" [for]="'anyOf' + i" style="cursor: pointer; flex: 1;">
                <strong style="color: #4c51bf; font-size: 0.95rem;" *ngIf="groupControl.get('anyOf')?.value; else allRequired">
                  <i class="fas fa-check-circle me-1"></i>
                  Any ONE subject required
                </strong>
                <ng-template #allRequired>
                  <strong style="color: #4c51bf; font-size: 0.95rem;">
                    <i class="fas fa-check-double me-1"></i>
                    ALL subjects required
                  </strong>
                </ng-template>
              </label>
            </div>
            <small class="text-muted mt-2 d-block" style="font-size: 0.75rem; padding-left: 0.5rem;">
              Toggle to change selection requirement
            </small>
          </div>
        </div>
      </div>

      <!-- Subjects Section -->
      <div formArrayName="subjects" class="border-2 border-dashed rounded-3 p-4" 
           style="border-color: #c7d2fe !important; background: linear-gradient(to bottom, #f8faff 0%, #ffffff 100%); border-radius: 12px;">
        <div class="d-flex justify-content-between align-items-center mb-4">
          <h6 class="mb-0 d-flex align-items-center" style="color: #4c51bf; font-weight: 600;">
            <div class="bg-primary bg-opacity-10 rounded-circle p-2 me-2">
              <i class="fas fa-book-open" style="font-size: 0.9rem; color: #667eea;"></i>
            </div>
            Subjects in Group {{ i + 1 }}
          </h6>
          <button
            type="button"
            class="btn btn-primary btn-sm shadow-sm"
            (click)="addSubjectToGroup(i)"
            style="padding: 0.5rem 1.25rem; border-radius: 8px; font-weight: 500; transition: all 0.2s;"
            onmouseover="this.style.transform='translateY(-1px)'; this.style.boxShadow='0 4px 12px rgba(102,126,234,0.4)';"
            onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 4px rgba(0,0,0,0.1)';"
          >
            <i class="fas fa-plus me-1"></i>Add Subject
          </button>
        </div>

        <!-- No subjects state -->
        <div *ngIf="getSubjects(groupControl).length === 0" 
             class="text-center py-5"
             style="background: white; border-radius: 10px; border: 2px dashed #e2e8f0;">
          <div class="mb-3" style="font-size: 3rem; color: #cbd5e0;">
            <i class="fas fa-inbox"></i>
          </div>
          <p class="mb-0 text-muted" style="font-size: 0.9rem;">No subjects added yet. Click "Add Subject" to begin.</p>
        </div>

        <!-- Subject List -->
        <div
          *ngFor="let subjCtrl of getSubjects(groupControl).controls; let j = index"
          [formGroupName]="j"
          class="card border-0 mb-3"
          style="box-shadow: 0 2px 8px rgba(0,0,0,0.06); border-radius: 12px; transition: all 0.2s ease;"
          onmouseover="this.style.transform='translateX(4px)'; this.style.boxShadow='0 4px 12px rgba(0,0,0,0.1)';"
          onmouseout="this.style.transform='translateX(0)'; this.style.boxShadow='0 2px 8px rgba(0,0,0,0.06)';"
        >
          <div class="card-body p-3">
            <div class="row g-3 align-items-center">
              <div class="col-auto">
                <div class="text-white rounded-circle d-flex align-items-center justify-content-center"
                     style="width: 40px; height: 40px; font-weight: 600; font-size: 0.95rem; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); box-shadow: 0 2px 8px rgba(102,126,234,0.3);">
                  {{ j + 1 }}
                </div>
              </div>
              <div class="col">
                <select class="form-select border-2" formControlName="name"
                        style="border-color: #e2e8f0; border-radius: 8px; padding: 0.65rem 0.9rem; font-size: 0.9rem; transition: all 0.2s;"
                        onfocus="this.style.borderColor='#667eea'; this.style.boxShadow='0 0 0 3px rgba(102,126,234,0.1)';"
                        onblur="this.style.borderColor='#e2e8f0'; this.style.boxShadow='none';">
                  <option value="">-- Select Subject --</option>
                  <option *ngFor="let s of combinedSubjects" [value]="s">{{ s }}</option>
                </select>
              </div>
              <div class="col-auto">
                <button
                  type="button"
                  class="btn btn-outline-danger btn-sm"
                  (click)="removeSubjectFromGroup(i, j)"
                  title="Remove subject"
                  style="width: 36px; height: 36px; border-radius: 8px; padding: 0; transition: all 0.2s;"
                  onmouseover="this.style.background='#dc3545'; this.style.borderColor='#dc3545'; this.style.color='white'; this.style.transform='scale(1.05)';"
                  onmouseout="this.style.background='transparent'; this.style.borderColor='#dc3545'; this.style.color='#dc3545'; this.style.transform='scale(1)';"
                >
                  <i class="fas fa-times"></i>
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Add subject button (bottom) -->
        <button
          *ngIf="getSubjects(groupControl).length > 0"
          type="button"
          class="btn btn-outline-primary w-100 mt-3"
          (click)="addSubjectToGroup(i)"
          style="border-width: 2px; border-radius: 10px; padding: 0.75rem; font-weight: 500; transition: all 0.2s; border-style: dashed;"
          onmouseover="this.style.background='#667eea'; this.style.borderColor='#667eea'; this.style.color='white'; this.style.borderStyle='solid';"
          onmouseout="this.style.background='transparent'; this.style.borderColor='#667eea'; this.style.color='#667eea'; this.style.borderStyle='dashed';"
        >
          <i class="fas fa-plus me-2"></i>Add Another Subject
        </button>
      </div>
    </div>
  </div>

  <!-- Add New Group Button -->
  <button
    type="button"
    class="btn btn-lg btn-success w-100 shadow-sm"
    (click)="addAlternativeGroup()"
    style="border-radius: 12px; padding: 1rem; font-weight: 600; font-size: 1rem; background: linear-gradient(135deg, #10b981 0%, #059669 100%); border: none; transition: all 0.3s ease;"
    onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 20px rgba(16,185,129,0.4)';"
    onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 6px rgba(0,0,0,0.1)';"
  >
    <i class="fas fa-plus-circle me-2"></i>
    Add New Alternative Group
  </button>
</div>









































      <!-- ========== Submit Buttons ========== -->
      <div class="row mt-5 action-buttons">
        <div class="col-12 col-md-6 mb-2 mb-md-0">
          <button type="reset"  class="btn btn-outline-secondary modern-btn-outline w-100">Reset</button>
        </div>

        <div class="col-12 col-md-6 mb-2 mb-md-0">

          <button type="submit"
            class="btn btn-primary modern-btn-primary w-100 d-flex justify-content-center align-items-center"
            [disabled]="isSubmitting">

            <ng-container *ngIf="!isSubmitting">
              <i class="fas fa-paper-plane me-2"></i> Submit Program
            </ng-container>

            <ng-container *ngIf="isSubmitting">
              <i class="fas fa-spinner fa-spin me-2"></i> Submitting...
            </ng-container>
          </button>
        </div>

      </div>
    </div>
  </div>
</form>